apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: mvn
spec:
  description: >-
    This Task can be used to run a Maven build.
  workspaces:
  - name: shared-workspace
  params:
    - name: GOALS
      description: The Maven goals to run
      type: array
      default: 
        - "package"
  resources:
    inputs:
      - name: source
        type: git
    
  steps:
    - name: mvn
      image: gcr.io/cloud-builders/mvn
      workingDir: /workspace/source
      command: ["/usr/bin/mvn"]
      args:
        - -Dmaven.repo.local=$(workspaces.maven-repo.path)
        - "$(params.GOALS)"
---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: new-app
  labels:
    app.kubernetes.io/version: "0.1"
  annotations:
    tekton.dev/pipelines.minVersion: "0.12.1"
    tekton.dev/tags: cli
    tekton.dev/displayName: "openshift client"
spec:
  description: >-
    This task runs commands against the cluster where the task run is
    being executed.
  params:
  - name: SCRIPT
    description: The OpenShift CLI arguments to run
    type: string
    default: "oc $@"
  - name: NEWAPP
    description: The OpenShift CLI arguments to run
    type: array
    default:
    - "new-app s2i-payara-micro:latest~$(resources.inputs.repository.path)/ --name=micro-example"
  resources:
    inputs:
      - name: repository
        type: git
  steps:
    - name: new-app
      image: quay.io/openshift/origin-cli:latest
      script: "$(params.SCRIPT)"
      args:
        - "$(params.NEWAPP)"
---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: build-war
  labels:
    app.kubernetes.io/version: "0.1"
  annotations:
    tekton.dev/pipelines.minVersion: "0.12.1"
    tekton.dev/tags: cli
    tekton.dev/displayName: "openshift client"
spec:
  description: >-
    This task runs commands against the cluster where the task run is
    being executed.
  params:
  - name: SCRIPT
    description: The OpenShift CLI arguments to run
    type: string
    default: "oc $@"
  - name: BUILD
    description: The OpenShift CLI arguments to run
    type: array
    default:
    - "start-build --from-dir $(resources.inputs.repository.path)/target/. micro-example"
  resources:
    inputs:
      - name: repository
        type: git
  steps:
    - name: new-app
      image: quay.io/openshift/origin-cli:latest
      script: "$(params.SCRIPT)"
      args:
        - "$(params.BUILD)"
---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: expose-micro
  labels:
    app.kubernetes.io/version: "0.1"
  annotations:
    tekton.dev/pipelines.minVersion: "0.12.1"
    tekton.dev/tags: cli
    tekton.dev/displayName: "openshift client"
spec:
  description: >-
    This task runs commands against the cluster where the task run is
    being executed.
  params:
  - name: SCRIPT
    description: The OpenShift CLI arguments to run
    type: string
    default: "oc $@"
  - name: EXPOSE
    description: The OpenShift CLI arguments to run
    type: array
    default:
    - "expose svc micro-example --port=8080"
  resources:
    inputs:
      - name: repository
        type: git
  steps:
    - name: new-app
      image: quay.io/openshift/origin-cli:latest
      script: "$(params.SCRIPT)"
      args:
        - "$(params.EXPOSE)"